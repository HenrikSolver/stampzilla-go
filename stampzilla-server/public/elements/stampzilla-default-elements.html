<link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="/bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-down.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-up.html">
<link rel="import" href="/bower_components/core-animated-pages/transitions/slide-from-right.html">
<link rel="import" href="/bower_components/font-roboto/roboto.html">
<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="/bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="/bower_components/core-menu/core-menu.html">
<link rel="import" href="/bower_components/core-item/core-item.html">
<link rel="import" href="/bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="/bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="/bower_components/core-menu/core-submenu.html">
<link rel="import" href="/bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="/bower_components/paper-slider/paper-slider.html">
<link rel="import" href="/bower_components/color-picker-element/dist/color-picker.html">
<link rel="import" href="stampzilla-element-toggle.html">
<link rel="import" href="stampzilla-element-text.html">

<polymer-element name="stampzilla-default-elements" attributes="device elements wsSend devices" >
	<template>
		<link rel="stylesheet" href="stampzilla-default-elements.css">

		<template repeat="{{ element,key in elements  }}">
			<template if="{{ element.Type == 0 }}">
				<stampzilla-element-text element1="{{element}}" device="{{device}}" wsSend="{{wsSend}}"></stampzilla-element-toggle>
			</template>
			
			<template if="{{ element.Type == 1 }}">
				<div>BUTTON - {{element.Name}}</div>
				<paper-toggle-button data-element="{{key}}" on-change={{toggleButtonChange}}></paper-toggle-button>
			</template>

			<template if="{{ element.Type == 2 }}">
				<stampzilla-element-toggle element1="{{element}}" device="{{device}}" wsSend="{{wsSend}}"></stampzilla-element-toggle>
			</template>

			<template if="{{ element.Type == 3 }}">
				<div>SLIDER - {{element.Name}}</div>
				<paper-slider pin value="{{action.data.State.Dim}}"></paper-slider>
			</template>
			<template if="{{ element.Type == 4 }}">
				<div>COLOR PICKER - {{element.Name}}</div>
                <color-picker on-colorselected="{{colorSelect}}"></paper-slider>
			</template>
		</template>
	
	</template>
	<script>
		/* jshint newcap: false */
		/*global Polymer */


		(function() {
			"use strict";

			Polymer('stampzilla-default-elements', {
                elements: [],
				device: {},
				devicesChanged: function(){

					if( this.device !== undefined && this.device.Uuid !== undefined && this.devices[this.getDeviceIndex(this.device.Uuid)] !== this.device){
						console.log("devices changed in elements",this.devices);
						this.device = this.devices[this.getDeviceIndex(this.device.Uuid)];
					}

				},
				getDeviceIndex: function(uuid){
					for(var index in this.devices) {
						if (this.devices.hasOwnProperty(index) && this.devices[index].Uuid === uuid ) {
							return index;
						}
					}
				},
                toggleButtonChange: function(a,b,el) {
					var element = this.elements[el.dataset.element];
					console.log(element);

					var cmd = {
						type:'cmd',
						to:this.device.Uuid,
						data:element.Command
					};
					this.wsSend = cmd;
					//WIHO THIS WORKS and turns on/off my lamp :D:D
                },

                colorSelect: function (e){
                    console.log(e);
                    console.log(e.detail.hex + ' (r=' + e.detail.rgb.r + ', g=' + e.detail.rgb.g + ', b=' + e.detail.rgb.b + ')');
				},

				ready: function(){

                }
			});


			//{
			//	Type: 1,
			//	Name: "Example button",
			//	Command: {
			//		cmd: "set",
			//		args: [
			//			"1"
			//		]
			//	},
			//	Feedback: "Devices[1].State"
			//},

		})();
	</script>
</polymer-element>
